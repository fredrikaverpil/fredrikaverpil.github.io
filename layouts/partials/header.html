<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- SEO & Meta -->
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    {{ with .Description }}<meta name="description" content="{{ . }}">{{ else }}{{ with .Site.Params.description }}<meta name="description" content="{{ . }}">{{ end }}{{ end }}
    <link rel="canonical" href="{{ .Permalink }}">
    
    <!-- Social Media (Open Graph & Twitter) -->
    {{ template "_internal/opengraph.html" . }}
    {{ template "_internal/twitter_cards.html" . }}
    
    <!-- JSON-LD Structured Data -->
    {{ partial "seo_schema.html" . }}

    <link rel="shortcut icon" href="{{ "favicon.ico" | relURL }}" type="image/x-icon" />
    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/github-link.css" | relURL }}" />
    {{ with .OutputFormats.Get "RSS" }}
    <link rel="alternate" type="{{ .MediaType.Type }}" href="{{ .RelPermalink }}" title="{{ $.Site.Title }}">
    {{ end }}
    {{ partial "head_custom.html" . }}
  </head>

  <body class="preload">
    <script>
      (function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.body.classList.add(savedTheme);
        } else {
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark');
          }
        }
        setTimeout(() => {
          document.body.classList.remove('preload');
        }, 100);
      })();
    </script>

    <nav style="display: flex; align-items: center; gap: 1em; flex-wrap: wrap;">
      <ul class="menu" style="margin: 0; padding: 0; flex-shrink: 0;">
        {{ $url := .RelPermalink }}
        {{ range .Site.Menus.main }}
        <li><a {{ if eq $url .URL }}class="active"{{ end }} href="{{ .URL | relURL }}">{{ .Name }}</a></li>
        {{ end }}
        <li><button id="theme-toggle" style="background:none; border:none; cursor:pointer; font-size:1em; padding:5px; color:inherit;">◑</button></li>
      </ul>
      
      <!-- Pagefind Search Integration -->
      <div id="search" style="flex-grow: 1; min-width: 200px;"></div>
    </nav>
    
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ 
              element: "#search", 
              showSubResults: true,
              showImages: false,
              translations: {
                placeholder: "Search...",
                clear_search: "×"
              }
            });

            // Close search when clicking outside
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('#search');
                if (searchContainer && !searchContainer.contains(e.target)) {
                    const clearButton = searchContainer.querySelector('.pagefind-ui__search-clear');
                    if (clearButton) {
                        clearButton.click();
                    }
                }
            });

            // Theme Toggle Logic
            const toggle = document.getElementById('theme-toggle');
            const body = document.body;

            toggle.addEventListener('click', () => {
              if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                body.classList.add('light');
                localStorage.setItem('theme', 'light');
              } else {
                body.classList.remove('light');
                body.classList.add('dark');
                localStorage.setItem('theme', 'dark');
              }
            });
        });
    </script>